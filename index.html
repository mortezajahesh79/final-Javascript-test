<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>serach git</title>
    <link rel="stylesheet" href="./asset/style/global.css" />
    <link rel="stylesheet" href="./asset/style/page/index.css" />
  </head>
  <body>
    <header class="header">
      <nav>
        <ul>
          <li><a href="index.html">Github</a></li>
          <li><a href="time.html">Time</a></li>
          <li><a href="weather.html">Weather</a></li>
        </ul>
      </nav>
    </header>
    <div class="container">
      <div class="form-control">
        <form action="" id="form-users">
          <input type="text" placeholder="search Users" name="user" />
          <div class="actions">
            <button class="submit-btn">Submit</button>
            <button class="clear-btn" type="button">Clear</button>
          </div>
        </form>
        <ul id="users"></ul>
      </div>
    </div>

    <script type="module">

import baseUrl from "./asset/script/base-url.js";
import { getUsers } from "./asset/script/get-api.js";

const listUsers = document.getElementById("users");
const fromUsers = document.getElementById("form-users");
const clearBtn = fromUsers.querySelector(".clear-btn");
const body = document.querySelector("body");

let clicked = false;

const showUsers = async (e) => {
  e.preventDefault();
  const query = fromUsers.user.value.trim().toLowerCase();
  localStorage.setItem("query", query);

  if (clicked) {
    return;
  }

  if (!query) {
    error();
    return;
  }

  listUsers.innerHTML = `<div class="loader"></div>`;
  const usersInfo = await getUsers(query);
  if (usersInfo.items) {
    const users = usersInfo.items;
    listUsers.innerHTML = "";
    users.forEach((user) => {
      const userAvator = user.avatar_url;
      const userLogin = user.login;
      listUsers.innerHTML += `
          <li>
            <img src="${userAvator}" alt="this is users\'s profile" />  
            <h3>${userLogin}</h3>
            <a href="single-user.html?user=${userLogin}">More</a>
          </li>
          `;
    });
    clearBtn.style.display = `block`;
    fromUsers.user.value = "";
  } else {
    // Set Error
    body.innerHTML = usersInfo;
  }
};

fromUsers.addEventListener("submit", showUsers);
if (performance.navigation && performance.navigation.type === 1) {
  localStorage.setItem("query", "");
}

clearBtn.addEventListener("click", () => {
  listUsers.innerHTML = "";
  clearBtn.style.display = `none`;
  localStorage.setItem("query", "");
});

const showUsersFromLocal = async () => {
  const queryLocal = localStorage.getItem("query");

  if (queryLocal) {
    listUsers.innerHTML = `<div class="loader"></div>`;
    const usersInfo = await getUsers(queryLocal);
    const users = usersInfo.items;
    listUsers.innerHTML = "";
    users.forEach((user) => {
      const userAvator = user.avatar_url;
      const userLogin = user.login;
      listUsers.innerHTML += `
          <li>
            <img src="${userAvator}" alt="this is users\'s profile" />  
            <h3>${userLogin}</h3>
            <a href="single-user.html?user=${userLogin}">More</a>
          </li>
          `;
    });
    clearBtn.style.display = `block`;
    fromUsers.user.value = "";
  }
};
showUsersFromLocal();



    </script>
  </body>
</html>
